// qcl /AL gload.c

#include <conio.h>
#include <stdio.h>

int main()
{
	long gvram[] = { 0xa8000000, 0xb0000000, 0xb8000000, 0xe0000000 };
	char pal[][3] = {
		{0x00,0x00,0x00},
		{0xff,0x00,0x00},
		{0x00,0xff,0x00},
		{0xff,0xff,0x00},

		{0x00,0x00,0x55},
		{0xff,0x00,0x55},
		{0x00,0xff,0x55},
		{0xff,0xff,0x55},

		{0x00,0x00,0xaa},
		{0xff,0x00,0xaa},
		{0x00,0xff,0xaa},
		{0xff,0xff,0xaa},

		{0x00,0x00,0xff},
		{0xff,0x00,0xff},
		{0x00,0xff,0xff},
		{0xff,0xff,0xff},
	};
	FILE *pf;
	int i;

	// CRT BIOS
	_asm {
	mov	ah, 40h		; graphic on
	int	18h
	mov	ah, 42h
	mov	ch, 0c0h	; 640x400 color page1
	int	18h
	}

	// T-GDC write mode register 2
	outp(0x6a, 0x01);	// 16 colors

	for (i = 0; i < 15; i++) {
		outp(0xa8, i);
		outp(0xae, pal[i][0]);
		outp(0xac, pal[i][1]);
		outp(0xaa, pal[i][2]);
	}

	pf = fopen("sample.bin", "rb");
	if (pf == NULL) {
		fprintf(stderr, "fopen\n");
		return 1;
	}
	for (i = 0; i < 4; i++) {
		fread((void *)gvram[i], 32000, 1, pf);
	}
	fclose(pf);
	return 0;
}
